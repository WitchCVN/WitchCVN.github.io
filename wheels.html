<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horizontal Image Roulette</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #333;
            position: relative; /* Для позиционирования стрелки */
        }
        #container {
            position: relative;
            width: 1000px; /* Ширина контейнера */
            height: 500px; /* Высота контейнера */
        }

        #wheelCanvas {
            display: block;
            background-color: transparent;
        }

        #arrow {
            position: absolute;
            top: -10px; /* Позиция стрелки, теперь на -10px от верхней части */
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 40px solid transparent; /* Ширина стрелки */
            border-right: 40px solid transparent; /* Ширина стрелки */
            border-top: 60px solid #333; /* Высота стрелки */
            z-index: 10; /* Стрелка над изображениями */
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="arrow"></div> <!-- Стрелка -->
        <canvas id="wheelCanvas" width="1000" height="500"></canvas> <!-- Размеры канваса -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script>
        var wheelOptions = [
            'options/Image1.jpg',
            'options/Image2.jpg',
            'options/Image3.jpg',
            'options/Image4.jpg',
            'options/Image5.jpg',
            'options/Image6.jpg'
        ];

        var canvas = document.getElementById("wheelCanvas");
        var ctx = canvas.getContext("2d");

        var images = [];
        var totalImages = wheelOptions.length;
        var originalHeight = 2007; // Исходная высота картинки
        var originalWidth = 1140;   // Исходная ширина картинки
        var imageHeight = originalHeight * 0.25; // Высота после уменьшения до 25%
        var imageWidth = originalWidth * 0.25;   // Ширина после уменьшения до 25%
        var startPosition = 0;  // Стартовая позиция анимации
        var isSpinning = false; // Состояние вращения

        // Загружаем изображения
        function loadImages(callback) {
            let loadedImages = 0;
            for (let i = 0; i < totalImages; i++) {
                images[i] = new Image();
                images[i].src = wheelOptions[i];
                images[i].onload = function () {
                    loadedImages++;
                    if (loadedImages === totalImages) {
                        callback();
                    }
                };
            }
        }

        // Отрисовка рулетки
        function drawWheel(offsetX) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);  // Очищаем canvas

            for (let i = 0; i < totalImages; i++) {
                let xPosition = (i * imageWidth + offsetX) % (imageWidth * totalImages);  // Рассчитываем позицию картинки
                if (xPosition < -imageWidth) {
                    xPosition += imageWidth * totalImages;  // Повторяем прокрутку
                }
                ctx.drawImage(images[i], xPosition, (canvas.height - imageHeight) / 2, imageWidth, imageHeight);  // Рисуем изображение по центру
            }
        }

        // Анимация рулетки
        function spinWheel() {
            if (isSpinning) return; // Если уже вращается, ничего не делаем
            isSpinning = true; // Устанавливаем флаг вращения

            // Генерируем случайное начальное положение
            var randomStart = Math.floor(Math.random() * totalImages); 
            startPosition = -(imageWidth * randomStart); // Устанавливаем стартовую позицию

            // Целевая позиция для остановки
            var targetOffset = -(imageWidth * (totalImages + randomStart)); 

            // Настраиваем анимацию
            var duration = 15000; // Длительность анимации
            var tween = new TWEEN.Tween({ x: startPosition })
                .to({ x: targetOffset }, duration)  // Длительность анимации
                .easing(TWEEN.Easing.Quintic.Out)
                .onUpdate(function (object) {
                    startPosition = object.x;  // Обновляем позицию
                    drawWheel(startPosition);
                })
                .onComplete(function() {
                    // Убедитесь, что рулетка останавливается точно на картинке
                    drawWheel(targetOffset);
                    isSpinning = false; // Сбрасываем флаг вращения
                })
                .start();
        }

        // Функция анимации
        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time);
        }

        // Начинаем анимацию после загрузки картинок
        loadImages(function () {
            spinWheel();
            animate();
        });
    </script>
</body>
</html>
